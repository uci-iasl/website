{{- $bibparams := .Site.Params.bibliography -}}

{{- $pagesbynameid := dict -}}
{{- range $page := where .Site.RegularPages "Section" "people" -}}
  {{- $name := $page.Params.bibname | default $page.Params.name -}}
  {{- $nameid := partial "bib/getnameid" (dict "name" $name "params" $bibparams) -}}
  {{- with index $pagesbynameid $nameid -}}
    {{- warnf "Personal pages %q and %q have identical bibliography lookup names" .File.Path $page.File.Path -}}
  {{- end -}}
  {{- $pagesbynameid = $pagesbynameid | merge (dict $nameid $page) -}}
{{- end -}}

{{- $collabsbynameid := dict -}}
{{- range $collab := $bibparams.collaborators -}}
  {{- $name := $collab.bibname | default $collab.name -}}
  {{- $nameid := partial "bib/getnameid" (dict "name" $name "params" $bibparams) -}}
  {{- with index $collabsbynameid $nameid -}}
    {{- warnf "More than one collaborator has bibliography lookup name id %q" $nameid -}}
  {{- end -}}
  {{- with index $pagesbynameid $nameid -}}
    {{- warnf "Collaborator with bibliography lookup name id %q collides with personal page %q" $nameid .File.Path -}}
  {{- end -}}
  {{- $collabsbynameid = $collabsbynameid | merge (dict $nameid $collab) -}}
{{- end -}}

{{- return (dict "internal" $pagesbynameid "external" $collabsbynameid) -}}
